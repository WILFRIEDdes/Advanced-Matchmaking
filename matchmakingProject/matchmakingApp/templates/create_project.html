{% extends "base.html" %}
{% load static %}

{% block title %}Créer un projet{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto bg-white p-8 rounded-xl shadow-xl">
    <h1 class="text-2xl font-bold mb-6">Créer un nouveau projet</h1>

    <form method="post" class="space-y-6 bg-white p-8 rounded shadow-md">
        {% csrf_token %}

        <div>
            <label class="block mb-1 font-semibold" for="id_nom">Nom du projet</label>
            <input type="text" name="nom" id="id_nom" class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-400">
        </div>
    
        <div>
            <label class="block mb-1 font-semibold" for="id_description">Description</label>
            <textarea name="description" id="id_description" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-400"></textarea>
        </div>
    
        <div class="flex space-x-6">
            <div class="w-1/2">
                <label class="block mb-1 font-semibold" for="id_date_debut">Date de début</label>
                <input type="date" name="date_debut" id="id_date_debut" class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-400">
            </div>
            <div class="w-1/2">
                <label class="block mb-1 font-semibold" for="id_date_fin">Date de fin</label>
                <input type="date" name="date_fin" id="id_date_fin" class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-400">
            </div>
        </div>

        <div class="mt-6">
            <h2 class="text-lg font-semibold mb-2">Compétences requises</h2>
            <div id="competence-container" class="space-y-4">
            </div>
            <input type="hidden" name="total_competences" id="total_competences" value="0">
            <button type="button" onclick="ajouterCompetence()" class="mt-6 mb-4 px-4 py-2 bg-green-600 text-white rounded-xl hover:bg-green-700 transition-all">
                + Ajouter une compétence
            </button>
        </div>

        <div>
            <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-xl hover:bg-blue-700 font-semibold">
                Créer le projet
            </button>
        </div>
    </form>
</div>

<script>
    const competences = JSON.parse('{{ competences_json|escapejs }}');
    let competenceCount = 0;

    function ajouterCompetence() {
        competenceCount++;
        document.getElementById('total_competences').value = competenceCount;

        const container = document.getElementById('competence-container');
        const div = document.createElement('div');
        div.classList.add('flex', 'space-x-4', 'items-center', 'mb-2');
        div.setAttribute('id', `competence-block-${competenceCount}`);

        div.innerHTML = `
            <select name="competence_${competenceCount}" class="w-1/2 px-3 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-400">
                ${competences.map(c => `<option value="${c.id}">${c.nom}</option>`).join('')}
            </select>
            <select name="niveau_${competenceCount}" class="w-1/3 px-3 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-400">
                <option value="Débutant">Débutant</option>
                <option value="Intermédiaire">Intermédiaire</option>
                <option value="Expert">Expert</option>
            </select>
            <button type="button" onclick="supprimerCompetence(${competenceCount})" class="text-red-600 text-xl hover:text-red-800">❌</button>
        `;
        container.appendChild(div);
    }

    function supprimerCompetence(id) {
        const block = document.getElementById(`competence-block-${id}`);
        if (block) {
            block.remove();
        }
    }
</script>


{% endblock %}